# langchain_community.chat_message_histories.upstash_redis â€” ðŸ¦œðŸ”— LangChain  documentation

**URL:** https://python.langchain.com/api_reference/_modules/langchain_community/chat_message_histories/upstash_redis.html
**Word Count:** 61
**Links Count:** 16
**Scraped:** 2025-07-21 09:14:31
**Status:** completed

---

# Source code for langchain\_community.chat\_message\_histories.upstash\_redis               import json     import logging     from typing import List, Optional          from langchain_core.chat_history import BaseChatMessageHistory     from langchain_core.messages import (         BaseMessage,         message_to_dict,         messages_from_dict,     )          logger = logging.getLogger(__name__)                              [[docs]](https://python.langchain.com/api_reference/community/chat_message_histories/langchain_community.chat_message_histories.upstash_redis.UpstashRedisChatMessageHistory.html#langchain_community.chat_message_histories.upstash_redis.UpstashRedisChatMessageHistory)     class UpstashRedisChatMessageHistory(BaseChatMessageHistory):         """Chat message history stored in an Upstash Redis database."""                         [[docs]](https://python.langchain.com/api_reference/community/chat_message_histories/langchain_community.chat_message_histories.upstash_redis.UpstashRedisChatMessageHistory.html#langchain_community.chat_message_histories.upstash_redis.UpstashRedisChatMessageHistory.__init__)         def __init__(             self,             session_id: str,             url: str = "",             token: str = "",             key_prefix: str = "message_store:",             ttl: Optional[int] = None,         ):             try:                 from upstash_redis import Redis             except ImportError:                 raise ImportError(                     "Could not import upstash redis python package. "                     "Please install it with `pip install upstash_redis`."                 )                  if url == "" or token == "":                 raise ValueError(                     "UPSTASH_REDIS_REST_URL and UPSTASH_REDIS_REST_TOKEN are needed."                 )                  try:                 self.redis_client = Redis(url=url, token=token)             except Exception:                 logger.error("Upstash Redis instance could not be initiated.")                  self.session_id = session_id             self.key_prefix = key_prefix             self.ttl = ttl                             @property         def key(self) -> str:             """Construct the record key to use"""             return self.key_prefix + self.session_id              @property         def messages(self) -> List[BaseMessage]:  # type: ignore[override]             """Retrieve the messages from Upstash Redis"""             _items = self.redis_client.lrange(self.key, 0, -1)             items = [json.loads(m) for m in _items[::-1]]             messages = messages_from_dict(items)             return messages                         [[docs]](https://python.langchain.com/api_reference/community/chat_message_histories/langchain_community.chat_message_histories.upstash_redis.UpstashRedisChatMessageHistory.html#langchain_community.chat_message_histories.upstash_redis.UpstashRedisChatMessageHistory.add_message)         def add_message(self, message: BaseMessage) -> None:             """Append the message to the record in Upstash Redis"""             self.redis_client.lpush(self.key, json.dumps(message_to_dict(message)))             if self.ttl:                 self.redis_client.expire(self.key, self.ttl)                                        [[docs]](https://python.langchain.com/api_reference/community/chat_message_histories/langchain_community.chat_message_histories.upstash_redis.UpstashRedisChatMessageHistory.html#langchain_community.chat_message_histories.upstash_redis.UpstashRedisChatMessageHistory.clear)         def clear(self) -> None:             """Clear session memory from Upstash Redis"""             self.redis_client.delete(self.key)